<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RTMMS Caretaker Portal</title>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background: #f4f7fb;
      color: #222;
    }

    header {
      position: relative;
      background-color: #2b6777;
      color: white;
      padding: 30px 20px;
      text-align: center;
      overflow: hidden; 
    }

    /* Watermark Image */
    header::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image: url("https://www.news-medical.net/images/Article_Images/ImageForArticle_25999_17442027107969162.jpg");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      opacity: 0.18;         
      pointer-events: none;  
      z-index: 0;
    }

    .header-content {
      position: relative;
      z-index: 1;
    }

    .header-content h1 {
      margin: 0;
      font-size: 1.8rem;
      letter-spacing: 0.03em;
    }

    .header-content h3 {
      margin: 6px 0 0;
      font-weight: 400;
      font-size: 1.05rem;
      opacity: 0.9;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px 16px 40px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* Summary strip above iframe */
    .summary-row {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
    }

    .summary-card {
      background: #ffffff;
      border-radius: 12px;
      padding: 10px 12px;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.08);
      border: 1px solid #e0e7ff;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .summary-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: #6b7280;
    }

    .summary-value {
      font-size: 1.3rem;
      font-weight: 600;
    }

    .summary-note {
      font-size: 0.75rem;
      color: #6b7280;
    }

    /* Dashboard header row (button + small description) */
    .dashboard-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-top: 4px;
    }

    .dashboard-text {
      font-size: 0.85rem;
      color: #4b5563;
    }

    .btn-open {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      background: #2b6777;
      color: #fff;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 6px 14px rgba(43, 103, 119, 0.45);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
    }

    .btn-open span {
      font-size: 1rem;
    }

    /* Iframe wrapper */
    .iframe-wrapper {
      margin-top: 8px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.15);
      overflow: hidden;
      background: white;
      border: 1px solid #e5e7eb;
    }

    iframe {
      border: none;
      width: 100%;
      height: 80vh;
      display: block;
    }

    .hint-text {
      margin-top: 6px;
      font-size: 0.75rem;
      color: #6b7280;
    }

    @media (max-width: 768px) {
      .summary-row {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 520px) {
      .summary-row {
        grid-template-columns: minmax(0, 1fr);
      }
      .dashboard-header {
        flex-direction: column;
        align-items: flex-start;
      }
      .btn-open {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <h1>Real-Time Multi-Modal Monitoring Systems</h1>
    </div>
  </header>

  <div class="container">
    <div class="summary-row">
  <div class="summary-card">
    <div class="summary-label">Monitored Patients</div>
    <div class="summary-value" id="monitoredPatients">â€“</div>
    <div class="summary-note" id="patientsNote">Loadingâ€¦</div>
  </div>
  <div class="summary-card">
    <div class="summary-label">Active Alerts (last 5 min)</div>
    <div class="summary-value" id="activeAlerts">â€“</div>
    <div class="summary-note" id="alertsNote">Loadingâ€¦</div>
  </div>
  <div class="summary-card">
    <div class="summary-label">Median Response Time</div>
    <div class="summary-value" id="medianResponse">â€“</div>
    <div class="summary-note" id="responseNote">Loadingâ€¦</div>
  </div>
</div>

    <div class="dashboard-header">
      <div class="dashboard-text">
        Below is your live RTMMS dashboard (Streamlit).  
        Use the button to open it in a separate tab if needed.
      </div>
      <a class="btn-open" href="http://localhost:8501" target="_blank" rel="noopener noreferrer">
        <span>ðŸ“ˆ</span> Open Full Dashboard
      </a>
    </div>

    <div class="iframe-wrapper">
      <iframe src="http://localhost:8501" title="RTMMS Dashboard"></iframe>
    </div>

    <div class="hint-text">
      Hint: keep this page as the caretaker-facing UI, and run the Python/Streamlit RTMMS
      backend separately. The iframe just embeds the live dashboard.
    </div>
  </div>

  <script>
  const SUMMARY_API = "http://localhost:8001/rtmms_dashboard/summary";

  async function refreshSummary() {
    try {
      const res = await fetch(SUMMARY_API);
      const data = await res.json();

      document.getElementById("monitoredPatients").textContent =
        data.monitored_patients ?? "â€“";

      document.getElementById("activeAlerts").textContent =
        data.active_alerts_5min ?? "â€“";

      const median = data.median_response_sec ?? null;
      document.getElementById("medianResponse").textContent =
        median !== null ? `${median.toFixed(0)}s` : "â€“";

      document.getElementById("patientsNote").textContent =
        data.error ? "Summary error â€“ see console" : "All rooms connected this shift";

      document.getElementById("alertsNote").textContent =
        `${data.critical_5min ?? 0} critical Â· ${data.warnings_5min ?? 0} early warnings`;

      document.getElementById("responseNote").textContent =
        data.error ? data.error : "Live from RTMMS event log";
    } catch (err) {
      console.error("Failed to fetch summary:", err);
    }
  }

  refreshSummary();
  setInterval(refreshSummary, 5000);
</script>
